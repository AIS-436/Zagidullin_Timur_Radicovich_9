# Запуск Java Spring Boot приложений в промышленной среде: настройка systemd и проксирование

## ОГЛАВЛЕНИЕ

* [Введение](#введение)
* [1. Особенности запуска Java-приложений в Production](#1-особенности-запуска-java-приложений-в-production)
  * [1.1 Формат поставки (Fat JAR)](#11-формат-поставки-fat-jar)
  * [1.2 Требования к окружению](#12-требования-к-окружению)
* [2. Управление процессом через systemd](#2-управление-процессом-через-systemd)
  * [2.1 Понятие systemd и Unit-файлов](#21-понятие-systemd-и-unit-файлов)
  * [2.2 Создание конфигурации службы](#22-создание-конфигурации-службы)
  * [2.3 Управление жизненным циклом приложения](#23-управление-жизненным-циклом-приложения)
* [3. Проксирование запросов (Nginx)](#3-проксирование-запросов-nginx)
  * [3.1 Зачем нужен Reverse Proxy](#31-зачем-нужен-reverse-proxy)
  * [3.2 Настройка Nginx для Spring Boot](#32-настройка-nginx-для-spring-boot)
  * [3.3 Обработка заголовков и SSL](#33-обработка-заголовков-и-ssl)
* [4. Безопасность и мониторинг](#4-безопасность-и-мониторинг)
  * [4.1 Управление пользователями и правами](#41-управление-пользователями-и-правами)
  * [4.2 Логирование (journald)](#42-логирование-journald)
  * [4.3 Тюнинг JVM](#43-тюнинг-jvm)
* [Заключение](#заключение)
* [Список литературы](#список-литературы)

---

## Введение

Java Spring Boot является одним из наиболее популярных фреймворков для разработки серверных приложений и микросервисов благодаря простоте конфигурации и встроенному веб-серверу. Возможность запуска приложения одной командой `java -jar` делает Spring Boot удобным на этапе разработки, однако в промышленной эксплуатации такой подход оказывается недостаточным.

В production-среде критически важны стабильность, безопасность, управляемость процессов и корректная обработка сетевого трафика. Приложение должно автоматически запускаться при старте системы, корректно завершаться, перезапускаться при сбоях, а также безопасно обрабатывать HTTP/HTTPS-запросы.

Для решения этих задач используется связка **systemd** и **Nginx**. Systemd управляет жизненным циклом Java-приложения, а Nginx выполняет функции обратного прокси-сервера, обеспечивая SSL-терминацию, маршрутизацию и защиту приложения.

Цель данного проекта — показать практический подход к развёртыванию Spring Boot приложения в промышленной Linux-среде с использованием systemd и Nginx.

---

## 1. Особенности запуска Java-приложений в Production

### 1.1 Формат поставки (Fat JAR)

Spring Boot использует формат **Fat JAR (Uber JAR)** — самодостаточный архив, содержащий:

* скомпилированный код приложения;
* все зависимости;
* встроенный веб-сервер (Tomcat, Jetty или Undertow).

Такой подход упрощает доставку приложения, однако прямой запуск JAR-файла в production имеет ряд недостатков:

* отсутствие фонового режима;
* отсутствие автоматического перезапуска;
* необходимость root-прав для работы с портами ниже 1024.

Поэтому в промышленной эксплуатации приложение запускается как системная служба.

---

### 1.2 Требования к окружению

Перед развёртыванием необходимо подготовить сервер:

* **Java**: рекомендуется использовать LTS-версии (17 или 21);
* **Отдельный пользователь**: приложение не должно запускаться от имени root;
* **Структура каталогов**:

  * `/opt/app` — исполняемые файлы;
  * `/etc/app` — конфигурация;
  * `/var/log/app` — логи.

Такой подход соответствует лучшим практикам безопасности и сопровождения.

---

## 2. Управление процессом через systemd

### 2.1 Понятие systemd и Unit-файлов

Systemd — современная система инициализации Linux. Для управления сервисами используются unit-файлы с расширением `.service`, которые располагаются в `/etc/systemd/system`.

Unit-файл состоит из секций:

* `[Unit]` — описание и зависимости;
* `[Service]` — параметры запуска;
* `[Install]` — параметры автозапуска.

---

### 2.2 Создание конфигурации службы

Ключевые параметры unit-файла для Spring Boot приложения:

* `User` — запуск от непривилегированного пользователя;
* `ExecStart` — команда запуска с указанием полного пути;
* `Restart=always` — автоматический перезапуск;
* `SuccessExitStatus=143` — корректное завершение Java-процесса.

Это обеспечивает отказоустойчивость и управляемость сервиса.

---

### 2.3 Управление жизненным циклом приложения

Основные команды systemd:

* `systemctl start app` — запуск;
* `systemctl stop app` — остановка;
* `systemctl status app` — проверка состояния;
* `systemctl enable app` — автозапуск при старте системы.

После изменения конфигурации требуется выполнить `systemctl daemon-reload`.

---

## 3. Проксирование запросов (Nginx)

### 3.1 Зачем нужен Reverse Proxy

Использование Nginx в качестве обратного прокси позволяет:

* скрыть внутреннюю архитектуру приложения;
* работать на стандартных портах 80 и 443;
* вынести SSL-шифрование из Java-приложения;
* эффективно отдавать статические файлы.

Spring Boot обычно слушает локальный порт (например, 8080), недоступный напрямую из интернета.

---

### 3.2 Настройка Nginx для Spring Boot

Nginx перенаправляет входящие запросы на локальный порт приложения. При этом важно передавать заголовки:

* `Host`
* `X-Real-IP`
* `X-Forwarded-For`
* `X-Forwarded-Proto`

Это позволяет приложению корректно определять источник запроса.

---

### 3.3 Обработка заголовков и SSL

Для корректной работы за прокси в Spring Boot необходимо включить поддержку forward-заголовков:

```
server.forward-headers-strategy=native
```

SSL-сертификаты обычно настраиваются через **Let’s Encrypt + Certbot**, а Nginx выполняет HTTPS-терминацию и редирект с HTTP на HTTPS.

---

## 4. Безопасность и мониторинг

### 4.1 Управление пользователями и правами

Рекомендуется:

* запускать приложение от отдельного пользователя;
* ограничить права на JAR-файл;
* не хранить пароли и ключи в коде.

Systemd поддерживает передачу секретов через переменные окружения.

---

### 4.2 Логирование (journald)

Systemd автоматически собирает логи приложения через `stdout` и сохраняет их в journald.

Полезные команды:

* `journalctl -u app -f`
* `journalctl -u app --since "1 hour ago"`

Это упрощает мониторинг и диагностику.

---

### 4.3 Тюнинг JVM

Для предотвращения переполнения памяти рекомендуется ограничивать ресурсы JVM:

* `-Xms`, `-Xmx` — размеры кучи;
* `-XX:+UseG1GC` — серверный сборщик мусора.

Без ограничений Java может потребить всю доступную память сервера.

---

## Заключение

В рамках проекта был рассмотрен практический подход к запуску Java Spring Boot приложений в промышленной среде Linux. Показано, что простой запуск через `java -jar` не удовлетворяет требованиям надежности и безопасности.

Связка **Spring Boot + systemd + Nginx** является отраслевым стандартом для эксплуатации Java-приложений вне контейнерных платформ и обеспечивает стабильную, безопасную и управляемую работу сервисов.

---

## Список литературы

1. Walls C. *Spring Boot in Action*. Manning Publications, 2016.
2. Spring.io. *Spring Boot Reference Documentation*.
   [https://docs.spring.io/spring-boot/docs/current/reference/html/](https://docs.spring.io/spring-boot/docs/current/reference/html/)
3. Freedesktop.org. *systemd System and Service Manager*.
   [https://www.freedesktop.org/wiki/Software/systemd/](https://www.freedesktop.org/wiki/Software/systemd/)
4. Nginx.org. *NGINX Reverse Proxy*.
   [https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/](https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/)
5. Baeldung. *Deploying Spring Boot Applications*.
   [https://www.baeldung.com/spring-boot-deployment](https://www.baeldung.com/spring-boot-deployment)
6. DigitalOcean. *How To Run Spring Boot as a Systemd Service*.
   [https://www.digitalocean.com/community/tutorials/how-to-deploy-a-spring-boot-application-on-ubuntu](https://www.digitalocean.com/community/tutorials/how-to-deploy-a-spring-boot-application-on-ubuntu)
7. Oracle. *Java HotSpot VM Garbage Collection Tuning Guide*.
   [https://docs.oracle.com/en/java/javase/17/gctuning/](https://docs.oracle.com/en/java/javase/17/gctuning/)
